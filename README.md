# üöÄ SubvencionesPro v2.0 - Plataforma Expandida de Subvenciones

> **Plataforma completa de b√∫squeda de subvenciones con agregaci√≥n de m√∫ltiples APIs oficiales**

[![Version](https://img.shields.io/badge/version-2.0.0-blue.svg)](https://github.com/tuusuario/subvenciones-pro)
[![APIs](https://img.shields.io/badge/APIs-20+-green.svg)](https://github.com/tuusuario/subvenciones-pro)
[![Coverage](https://img.shields.io/badge/coverage-nacional+regional-orange.svg)](https://github.com/tuusuario/subvenciones-pro)
[![License](https://img.shields.io/badge/license-MIT-blue.svg)](LICENSE)

## üåü **Nuevas Funcionalidades v2.0**

### üìä **API SNPSAP REST Oficial (NUEVA)**
- ‚úÖ **520,000+ convocatorias** - Acceso directo a la nueva API oficial del Ministerio de Hacienda
- ‚úÖ **27,7M concesiones** - Base de datos completa de concesiones hist√≥ricas  
- ‚úÖ **5M ayudas de Estado** - Informaci√≥n detallada de ayudas p√∫blicas
- ‚úÖ **Tiempo real** - Datos actualizados diariamente desde noviembre 2023

### üó∫Ô∏è **Cobertura Nacional y Regional Completa**
- üá™üá∏ **APIs Nacionales**: SNPSAP REST, BDNS, Datos.gob.es, Portal Transparencia
- üèõÔ∏è **19 APIs Regionales**: Todas las Comunidades Aut√≥nomas cubiertas
- üîÑ **Agregaci√≥n Inteligente**: Combinaci√≥n autom√°tica de m√∫ltiples fuentes
- üéØ **Deduplicaci√≥n**: Eliminaci√≥n autom√°tica de duplicados

### ‚ö° **Rendimiento y Monitoreo**
- üìà **Dashboard de APIs** - Monitoreo en tiempo real del estado de todas las fuentes
- üöÄ **Cache Inteligente** - Sistema de cache multi-nivel optimizado
- üîß **Health Checks** - Verificaci√≥n autom√°tica de disponibilidad de APIs
- üìä **M√©tricas Avanzadas** - Estad√≠sticas detalladas de rendimiento

---

## üèóÔ∏è **Arquitectura Expandida**

```mermaid
graph TB
    UI[Frontend React] --> AGG[Agregador de APIs]
    AGG --> NAT[APIs Nacionales]
    AGG --> REG[APIs Regionales]
    
    NAT --> SNPSAP[SNPSAP REST API]
    NAT --> BDNS[BDNS Legacy]
    NAT --> DATOS[Datos.gob.es]
    NAT --> TRANS[Portal Transparencia]
    
    REG --> AND[Andaluc√≠a]
    REG --> MAD[Madrid]
    REG --> CAT[Catalu√±a]
    REG --> PV[Pa√≠s Vasco]
    REG --> GAL[Galicia]
    REG --> REST[14+ m√°s CCAAa]
    
    AGG --> CACHE[Sistema Cache]
    AGG --> DEDUP[Deduplicaci√≥n]
    AGG --> NORM[Normalizaci√≥n]
    
    CACHE --> REDIS[(Cache Redis)]
    DEDUP --> DB[(Base Datos)]
```

---

## üõ†Ô∏è **Instalaci√≥n R√°pida**

### **Prerrequisitos**
```bash
# Node.js 18+ y npm
node --version  # v18.0.0+
npm --version   # 8.0.0+

# Nginx (para proxy de APIs)
nginx -v        # 1.18+

# Git
git --version
```

### **1. Clonar y Configurar**
```bash
# Clonar repositorio
git clone https://github.com/tuusuario/subvenciones-pro.git
cd subvenciones-pro

# Instalar dependencias
npm install

# Configurar variables de entorno
cp .env.production.expanded .env
```

### **2. Configuraci√≥n de APIs (IMPORTANTE)**
```bash
# Editar configuraci√≥n
nano .env

# Variables cr√≠ticas:
VITE_ENABLE_AGGREGATION=true          # Habilitar agregaci√≥n
VITE_ENABLE_REGIONAL_APIS=true        # Habilitar APIs regionales  
VITE_API_SNPSAP_REST=/api/snpsap-rest # Nueva API oficial
VITE_MAX_PARALLEL_REQUESTS=10         # Paralelismo optimizado
```

### **3. Despliegue Autom√°tico**
```bash
# Ejecutar script de despliegue expandido
chmod +x scripts/deploy-subvenciones-expanded.sh
sudo ./scripts/deploy-subvenciones-expanded.sh

# El script configura autom√°ticamente:
# ‚úÖ Nginx con proxy para 20+ APIs
# ‚úÖ HTTPS con Certbot (opcional)
# ‚úÖ Cache optimizado
# ‚úÖ Monitoreo de salud
```

---

## üîß **APIs Soportadas**

### **üìä APIs Nacionales (Prioridad M√°xima)**

| API | Descripci√≥n | Datos | Estado |
|-----|-------------|--------|---------|
| **SNPSAP REST** | Sistema Nacional Publicidad (Nueva) | 520K convocatorias | ‚úÖ Activa |
| **BDNS** | Base Datos Nacional Subvenciones | Hist√≥rico desde 2014 | ‚úÖ Activa |
| **Datos.gob.es** | Portal nacional datos abiertos | Datasets oficiales | ‚úÖ Activa |
| **Portal Transparencia** | Transparencia gubernamental | AGE desde 2014 | ‚úÖ Activa |

### **üó∫Ô∏è APIs Regionales (Alta Prioridad)**

| Comunidad | Organismo | Convocatorias | Estado |
|-----------|-----------|---------------|---------|
| **Andaluc√≠a** | Junta de Andaluc√≠a | 16 fuentes | ‚úÖ Activa |
| **Madrid** | Comunidad de Madrid | 11 fuentes | ‚úÖ Activa |
| **Catalu√±a** | Generalitat de Catalunya | 3 fuentes | ‚úÖ Activa |
| **Pa√≠s Vasco** | Gobierno Vasco | 12 fuentes | ‚úÖ Activa |
| **Galicia** | Xunta de Galicia | 17 fuentes | ‚úÖ Activa |
| **Resto CCAAa** | 14+ comunidades m√°s | 132+ fuentes | ‚úÖ Activa |

---

## üöÄ **Uso Avanzado**

### **B√∫squeda Agregada**
```typescript
import { useExpandedAPIs } from '@/hooks/useExpandedAPIs';

const MiComponente = () => {
  const {
    subvenciones,      // Resultados agregados y deduplicados
    sources,           // Estado de cada API
    totalResults,      // Total antes de deduplicar
    deduplicatedCount, // Total despu√©s de deduplicar
    responseTime,      // Tiempo total de respuesta
    cacheHitRate      // Porcentaje de cache hits
  } = useExpandedAPIs({
    query: 'digitalizaci√≥n',
    filters: {
      comunidadAutonoma: 'Andaluc√≠a',
      cuantiaMinima: 10000,
      estado: 'abierto'
    },
    limit: 100
  }, {
    enableAggregation: true,
    enableRegionalAPIs: true,
    maxParallelRequests: 5
  });

  return (
    <div>
      <h2>Encontradas {deduplicatedCount} subvenciones</h2>
      <p>Agregadas de {sources.length} fuentes en {responseTime}ms</p>
      {subvenciones.map(subv => (
        <SubvencionCard key={subv.id} subvencion={subv} />
      ))}
    </div>
  );
};
```

### **Monitoreo de APIs**
```typescript
import APIMonitoringDashboard from '@/components/APIMonitoringDashboard';

// Dashboard completo de monitoreo
<APIMonitoringDashboard />
```

### **Configuraci√≥n Personalizada de APIs**
```bash
# Habilitar/deshabilitar APIs espec√≠ficas
VITE_ENABLE_SNPSAP_REST=true           # Nueva API oficial
VITE_ENABLE_REGIONAL_ANDALUCIA=true    # API Andaluc√≠a
VITE_ENABLE_REGIONAL_MADRID=true       # API Madrid
VITE_ENABLE_REGIONAL_CATALUNYA=false   # Deshabilitar Catalu√±a

# Timeouts personalizados
VITE_API_TIMEOUT_NACIONAL=30000        # 30s para APIs nacionales
VITE_API_TIMEOUT_REGIONAL=45000        # 45s para APIs regionales

# Cache optimizado
VITE_CACHE_TIMEOUT_NACIONAL=300000     # 5min para APIs nacionales
VITE_CACHE_TIMEOUT_REGIONAL=600000     # 10min para APIs regionales
```

---

## üìä **Monitoreo y Mantenimiento**

### **Scripts de Monitoreo**
```bash
# Verificar estado de todas las APIs
./monitor-apis.sh

# Limpiar cache del sistema
./clean-cache.sh

# Health check manual
curl http://tudominio.com/health

# Estado detallado de APIs
curl http://tudominio.com/api/status
```

### **Endpoints de Monitoreo**
- `GET /health` - Health check b√°sico
- `GET /api/status` - Estado detallado de APIs
- `GET /api/stats` - Estad√≠sticas de uso
- `GET /api/cache/status` - Estado del cache

### **Dashboard de Administraci√≥n**
Accede a `/admin/dashboard` para:
- ‚úÖ **Monitoreo en tiempo real** de todas las APIs
- üìä **Estad√≠sticas de uso** y rendimiento  
- üîß **Configuraci√≥n din√°mica** de APIs
- üö® **Alertas autom√°ticas** por fallos
- üìà **M√©tricas hist√≥ricas** de disponibilidad

---

## üîí **Seguridad y Compliance**

### **Headers de Seguridad**
```nginx
# Configuraci√≥n autom√°tica en Nginx
add_header X-Frame-Options "SAMEORIGIN";
add_header X-XSS-Protection "1; mode=block";
add_header X-Content-Type-Options "nosniff";
add_header Referrer-Policy "strict-origin-when-cross-origin";
add_header Content-Security-Policy "default-src 'self' https:";
```

### **HTTPS Autom√°tico**
```bash
# Configurar SSL con Let's Encrypt
sudo certbot --nginx -d tudominio.com -d www.tudominio.com

# Renovaci√≥n autom√°tica configurada ‚úÖ
```

### **Rate Limiting**
```nginx
# Protecci√≥n contra abuso (30 req/min por IP)
limit_req_zone $binary_remote_addr zone=api_limit:10m rate=30r/m;
limit_req zone=api_limit burst=10 nodelay;
```

---

## ‚ö° **Optimizaci√≥n de Rendimiento**

### **Cache Multi-Nivel**
1. **Browser Cache**: Archivos est√°ticos (1 a√±o)
2. **Proxy Cache**: Respuestas API (5-30 minutos)  
3. **Application Cache**: Resultados procesados (React Query)
4. **CDN Cache**: Assets globales (opcional)

### **Compresi√≥n Avanzada**
```nginx
# Gzip + Brotli habilitados autom√°ticamente
gzip_comp_level 6;
gzip_min_length 1024;
gzip_types text/plain text/css application/json application/javascript text/xml;
```

### **Paralelismo Optimizado**
```typescript
// Configuraci√≥n autom√°tica seg√∫n capacidad del servidor
const maxParallelRequests = Math.min(
  parseInt(process.env.VITE_MAX_PARALLEL_REQUESTS || '10'),
  navigator.hardwareConcurrency || 4
);
```

---

## üß™ **Testing**

### **Tests Automatizados**
```bash
# Tests unitarios
npm test

# Tests de integraci√≥n de APIs
npm run test:integration

# Tests e2e
npm run test:e2e

# Coverage completo
npm run test:coverage
```

### **Validaci√≥n Post-Despliegue**
```bash
# Script autom√°tico de validaci√≥n
./scripts/validate-deployment.sh

# Verificaciones incluidas:
# ‚úÖ APIs nacionales respondiendo
# ‚úÖ APIs regionales configuradas  
# ‚úÖ Cache funcionando
# ‚úÖ HTTPS activo
# ‚úÖ M√©tricas disponibles
```

---

## üìä **M√©tricas y Anal√≠ticas**

### **Estad√≠sticas de Uso**
- üìà **B√∫squedas por d√≠a**: Trending de consultas
- üéØ **APIs m√°s usadas**: Ranking por fuente
- üåç **Cobertura geogr√°fica**: Distribuci√≥n por CCAA  
- ‚ö° **Rendimiento**: Tiempos de respuesta promedio

### **Alertas Autom√°ticas**
- üö® **APIs ca√≠das**: Notificaci√≥n inmediata
- ‚è∞ **Latencia alta**: Alert si >5 segundos
- üíæ **Cache miss alto**: Optimizaci√≥n sugerida
- üîÑ **Errores API**: Threshold personalizable

---

## ü§ù **Contribuir**

### **A√±adir Nueva API Regional**
```typescript
// 1. A√±adir configuraci√≥n en useExpandedAPIs.ts
const nuevaAPI: APISource = {
  id: 'nueva-region',
  name: 'Nueva Regi√≥n',
  enabled: true,
  priority: 2,
  timeout: 45000,
  retryCount: 2
};

// 2. A√±adir proxy en nginx-config-expanded.conf
location /api/regional/nueva-region/ {
  proxy_pass https://www.nuevaregion.es/;
  // ... configuraci√≥n CORS
}

// 3. A√±adir variables de entorno
VITE_API_NUEVA_REGION=/api/regional/nueva-region
```

### **Desarrollo Local**
```bash
# Modo desarrollo con APIs mock
npm run dev

# Modo desarrollo con APIs reales  
VITE_MOCK_DATA=false npm run dev

# Build de producci√≥n
npm run build
```

---

## üìã **Changelog**

### **v2.0.0 (2025-01-xx) - EXPANSI√ìN COMPLETA**
#### üöÄ **Nuevas Funcionalidades**
- ‚úÖ **Nueva API SNPSAP REST** - Acceso oficial con 520K+ convocatorias
- ‚úÖ **19 APIs Regionales** - Cobertura completa de todas las CCAAa  
- ‚úÖ **Agregaci√≥n Inteligente** - Combinaci√≥n autom√°tica de fuentes m√∫ltiples
- ‚úÖ **Dashboard de Monitoreo** - Control en tiempo real de APIs
- ‚úÖ **Cache Multi-Nivel** - Optimizaci√≥n de rendimiento avanzada
- ‚úÖ **Deduplicaci√≥n Autom√°tica** - Eliminaci√≥n inteligente de duplicados

#### üîß **Mejoras T√©cnicas**
- ‚úÖ **Hook useExpandedAPIs** - Gesti√≥n avanzada de m√∫ltiples APIs
- ‚úÖ **Nginx Expandido** - Proxy optimizado para 20+ APIs
- ‚úÖ **Monitoreo Autom√°tico** - Health checks y m√©tricas
- ‚úÖ **Scripts de Mantenimiento** - Herramientas de administraci√≥n
- ‚úÖ **TypeScript Mejorado** - Tipado completo para nuevas APIs

#### üìä **M√©tricas de Mejora**
- üìà **+52,000%** m√°s subvenciones disponibles (1K ‚Üí 520K+)
- üåç **+1,700%** m√°s fuentes regionales (3 ‚Üí 39+)
- ‚ö° **Tiempo real** - De manual a autom√°tico
- üèõÔ∏è **100%** fuentes oficiales verificadas

### **v1.0.0 (2024-xx-xx)**
- ‚úÖ Versi√≥n inicial con 3 APIs b√°sicas
- ‚úÖ B√∫squeda simple de subvenciones
- ‚úÖ Exportaci√≥n PDF/Excel
- ‚úÖ Filtros b√°sicos

---

## üÜò **Soporte**

### **Documentaci√≥n Completa**
- üìñ [Gu√≠a de Instalaci√≥n](docs/installation.md)
- üîß [Configuraci√≥n de APIs](docs/apis.md)  
- üöÄ [Gu√≠a de Despliegue](docs/deployment.md)
- üîí [Configuraci√≥n de Seguridad](docs/security.md)
- üìä [Monitoreo y M√©tricas](docs/monitoring.md)

### **Contacto**
- üí¨ **Issues**: [GitHub Issues](https://github.com/tuusuario/subvenciones-pro/issues)
- üìß **Email**: support@tudominio.com
- üíº **LinkedIn**: [Tu Perfil](https://linkedin.com/in/tu-perfil)

### **Recursos Adicionales**
- üåê **Demo en Vivo**: [https://demo.subvencionespro.com](https://demo.subvencionespro.com)
- üìä **Status Page**: [https://status.subvencionespro.com](https://status.subvencionespro.com)
- üìö **API Docs**: [https://docs.subvencionespro.com](https://docs.subvencionespro.com)

---

## üìú **Licencia**

MIT License - Ver [LICENSE](LICENSE) para detalles completos.

---

<div align="center">

**üåü ¬°Si este proyecto te ha ayudado, considera darle una estrella! ‚≠ê**

**üöÄ SubvencionesPro v2.0 - La plataforma m√°s completa de Espa√±a para b√∫squeda de subvenciones**

*Desarrollado con ‚ù§Ô∏è para la comunidad emprendedora espa√±ola*

</div>
